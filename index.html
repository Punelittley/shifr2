<!DOCTYPE html>
<!-- 
    ===============================================================
    довольно умно что сюда зашел
    Подсказка выбирается один раз на одно любое задание, вот ссылка
    >>> https://punelittley.github.io/podskazka/ <<<
    ===============================================================
-->
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⛓ THE CHAIN ⛓</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;600&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --text: #dcdcdc;
            --chain: #2a2a2a;
            --accent: #fff;
            --error: #800000;
            --success: #00ff00;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Cormorant Garamond', serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* --- ЦЕПИ --- */
        .chain-container {
            position: fixed;
            top: -100px; bottom: -100px;
            width: 60px;
            z-index: 1;
            overflow: hidden;
            display: flex;
            justify-content: center;
            opacity: 0.5;
            pointer-events: none;
        }
        .chain-left { left: 20px; }
        .chain-right { right: 20px; }
        .chain-links {
            display: flex;
            flex-direction: column;
            font-size: 40px;
            color: var(--chain);
            line-height: 35px;
            animation: moveChain 10s linear infinite;
        }
        @keyframes moveChain {
            0% { transform: translateY(0); }
            100% { transform: translateY(-50%); }
        }

        /* --- ИНТЕРФЕЙС --- */
        .main-container {
            z-index: 10;
            width: 90%;
            max-width: 800px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            letter-spacing: 6px;
            margin-bottom: 30px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            color: #666;
        }

        .riddle-content {
            font-size: 1.3rem;
            min-height: 300px;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: fadeIn 1s ease-in-out;
        }

        .binary-text {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            word-break: break-all;
            color: #555;
            margin-top: 20px;
            letter-spacing: 1px;
        }

        /* --- ПАЗЛ --- */
        .puzzle-wrapper {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            width: 400px;
            height: 400px;
            border: 1px solid #333;
            margin-top: 20px;
            background: #000;
        }

        .puzzle-piece {
            width: 100px;
            height: 100px;
            /* Генерация текстуры пазла */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400' style='background:%23080808'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.15'/%3E%3Cpath d='M0 0 L400 400' stroke='%23222' stroke-width='1'/%3E%3Cpath d='M400 0 L0 400' stroke='%23222' stroke-width='1'/%3E%3Ctext x='50%25' y='40%25' dominant-baseline='middle' text-anchor='middle' fill='%23ccc' font-family='serif' font-size='32px' letter-spacing='3px' font-weight='bold'%3EНЕСТАН%3C/text%3E%3Ctext x='50%25' y='60%25' dominant-baseline='middle' text-anchor='middle' fill='%23ccc' font-family='serif' font-size='32px' letter-spacing='3px' font-weight='bold'%3EДАРТНОСТЬ%3C/text%3E%3Crect x='5' y='5' width='390' height='390' stroke='%23333' fill='none' stroke-width='2'/%3E%3C/svg%3E");
            background-size: 400px 400px;
            cursor: pointer;
            box-shadow: inset 0 0 0 1px #222;
            transition: transform 0.2s, filter 0.2s;
        }

        .puzzle-piece:hover { filter: brightness(1.2); }
        .puzzle-piece.selected {
            box-shadow: inset 0 0 0 2px #fff;
            z-index: 10;
            transform: scale(0.95);
        }

        .puzzle-hint {
            font-size: 0.8rem;
            color: #555;
            margin-top: 15px;
            font-family: 'Cinzel', serif;
        }

        .word-list {
            list-style: none;
            padding: 0;
            font-family: 'Cinzel', serif;
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 1.1rem;
            opacity: 0.7;
        }

        input {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            width: 100%;
            max-width: 400px;
            color: #fff;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            text-align: center;
            padding: 10px;
            outline: none;
            transition: 0.3s;
            text-transform: uppercase;
        }
        input:focus { border-bottom-color: #fff; }

        .btn-action {
            margin-top: 20px;
            background: #111;
            border: 1px solid #444;
            color: #888;
            padding: 12px 35px;
            cursor: pointer;
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: 0.3s;
        }
        .btn-action:hover { border-color: #fff; color: #fff; }

        .status { margin-top: 15px; height: 20px; font-size: 0.8rem; color: var(--error); }

        .white-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; color: black; display: none;
            flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }
        .white-screen a {
            color: black; font-size: 1.5rem; text-decoration: none;
            border-bottom: 2px solid black; font-weight: bold;
        }

        @keyframes fadeIn { from { opacity: 0; filter: blur(10px); } to { opacity: 1; filter: blur(0); } }
        .shake { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }

        @media (max-width: 500px) {
            .puzzle-wrapper { width: 300px; height: 300px; }
            .puzzle-piece { width: 75px; height: 75px; background-size: 300px 300px; }
        }
    </style>
</head>
<body>

    <div class="chain-container chain-left"><div class="chain-links"><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span></div></div>
    <div class="chain-container chain-right"><div class="chain-links"><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span><span>⛓</span></div></div>

    <div class="main-container" id="game-ui">
        <h1>SEQUENCE <span id="lvl-num">I</span></h1>

        <div id="riddle-box" class="riddle-content"></div>

        <input type="text" id="answer-input" placeholder="ОТВЕТ" autocomplete="off">
        <div class="status" id="feedback"></div>
        <button id="dl-btn" class="btn-action" style="display:none" onclick="downloadFile()">СКАЧАТЬ ФАЙЛ</button>
    </div>

    <div class="white-screen" id="final-screen">
        <p style="font-family: 'Cinzel', serif; letter-spacing: 5px; margin-bottom: 30px;">ТЫ НАШЕЛ ВЫХОД</p>
        <a href="https://t.me/+yYk8iGiLdktjYTM6" target="_blank">НАПИСАТЬ</a>
    </div>

    <script>
        console.log("%c STOP! \n Ответы здесь не найти. \n Если ты застрял, иди сюда: https://t.me/+yYk8iGiLdktjYTM6", "color: red; font-size: 20px; font-weight: bold;");

        const levels = [
            {
                id: 1,
                text: `<p>Я — первое. Моя жизнь — позиция в яукяэцмъ.</p><p style="letter-spacing: 3px; border: 1px solid #333; padding: 10px;">2, 5, 7, 9, 14, 14, 9, 14, 7</p>`,
                key: "YmVnaW5uaW5n"
            },
            {
                id: 2,
                text: `<p>Глаза обманывают? Верно?</p><div class="binary-text">00100000 11010000 10111110 11010000 10110100 11010000 10110000 00100000 11010000 11010000 10110000 11010000 11010000 10111110 11010000 10110101 11010000 10110111 11010001 10000011 00100000 11010001 10000000 11010000 10110000 00100000 11010001 10000001 11010000 10110010 00100000</div>`,
                key: "0YHQstC+0LHQvtC00LDRgNCw0LfRg9C80LA="
            },
            {
                id: 3,
                text: `<p>То, что ты видишь, имеет правильную суть?</p><div class="binary-text" style="color:#444">11010001 10000010 11010000 10111000 11010000 10111111 11010000 10111000 11010001 10000111 11010000 10111101 11010000 10111110 11010000 10110101 11010001 10000001 11010000 10110010 11010000 10111110 11010000 10110101 11010000 10111110 11010001 10000010 11010000 10110001 11010001 10000000 11010000 10111110 11010001 10000001 11010001 10001100 11010000 10111100 11010001 10001011 11010001 10001000 11010000 10111011 11010000 10110101 11010000 10111101 11010000 10111000 11010000 10110101</div>`,
                key: "0L7RgtCx0YDQvtGB0YzRgdCy0L7QtdC80YvRiNC70LXQvdC40LU="
            },
            {
                id: 4,
                text: `<p>Истина разбита на 16 частей.</p><div id="puz-wrap" class="puzzle-wrapper"></div><div class="puzzle-hint">(Нажми на две детали, чтобы поменять их местами)</div>`,
                key: "0L3QtdGB0YLQsNC90LTQsNGA0YLQvdC+0YHRgtGM",
                isPuzzle: true
            },
            {
                id: 5,
                text: `<p>Думаешь метаться из стороны в сторону лучшая идея?</p><ul class="word-list"><li>Down</li><li>pianO</li><li>Negation</li><li>lighT</li><li>Anti</li><li>selF</li><li>Raise</li><li>akA</li><li>Interesting</li><li>voiD</li></ul>`,
                key: "ZG9udGFmcmFpZA=="
            },
            {
                id: 6,
                text: `<p>Ответ скрыт внутри.</p>`,
                key: "0LbQuNC30L3RjA==",
                isFile: true
            }
        ];

        let current = 0;
        let selectedPiece = null;

        const ui = {
            lvl: document.getElementById('lvl-num'),
            box: document.getElementById('riddle-box'),
            inp: document.getElementById('answer-input'),
            msg: document.getElementById('feedback'),
            dlBtn: document.getElementById('dl-btn'),
            final: document.getElementById('final-screen'),
            game: document.getElementById('game-ui')
        };

        function initLevel() {
            if(current >= levels.length) {
                endGame();
                return;
            }
            const data = levels[current];
            
            ui.box.style.animation = 'none';
            ui.box.offsetHeight; 
            ui.box.style.animation = 'fadeIn 1.2s ease-in-out';

            ui.lvl.innerText = toRoman(current + 1);
            ui.box.innerHTML = data.text;
            ui.inp.value = "";
            ui.msg.innerText = "";
            
            if(data.isPuzzle) initPuzzle();
            ui.dlBtn.style.display = data.isFile ? 'inline-block' : 'none';
            ui.inp.focus();
        }

        function initPuzzle() {
            const wrapper = document.getElementById('puz-wrap');
            if(!wrapper) return;
            wrapper.innerHTML = '';
            
            let indices = Array.from({length: 16}, (_, i) => i);
            indices.sort(() => Math.random() - 0.5);

            indices.forEach((posIndex, i) => {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                const col = posIndex % 4; 
                const row = Math.floor(posIndex / 4);
                piece.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
                piece.onclick = () => handlePieceClick(piece);
                wrapper.appendChild(piece);
            });
        }

        function handlePieceClick(piece) {
            if (!selectedPiece) {
                selectedPiece = piece;
                piece.classList.add('selected');
            } else {
                const tempBg = selectedPiece.style.backgroundPosition;
                selectedPiece.style.backgroundPosition = piece.style.backgroundPosition;
                piece.style.backgroundPosition = tempBg;
                
                selectedPiece.classList.remove('selected');
                selectedPiece = null;
            }
        }

        // КОДИРОВАНИЕ ОТВЕТА (UTF-8 SAFE BASE64)
        // Позволяет работать без сервера
        function safeEncode(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }

        function check() {
            const raw = ui.inp.value;
            const val = raw.toLowerCase().replace(/\s/g, '');
            const encodedVal = safeEncode(val);
            const target = levels[current].key;

            if (encodedVal === target) {
                ui.msg.innerText = "ДОСТУП РАЗРЕШЕН";
                ui.msg.style.color = "var(--success)";
                ui.inp.disabled = true;
                setTimeout(() => {
                    current++;
                    ui.inp.disabled = false;
                    initLevel();
                }, 1000);
            } else {
                ui.msg.innerText = "ОШИБКА ДОСТУПА";
                ui.msg.style.color = "var(--error)";
                ui.inp.classList.add('shake');
                setTimeout(() => ui.inp.classList.remove('shake'), 400);
            }
        }

        function downloadFile() {
            const content = `Поп обшйобёута т пеопдп гиепцб,\nоп оё гпиефц.\nПоп лпошбёута уйсё об лбноё,\nоп оё шёсуб.\nПоп уёшжу г зймбц,\nоп оё лспгэ.\nЁдп нпзоп рпуёсауэ г нпнёоу,\nоп оё обкуй об епспдё.\nПоп ётуэ гпрспт, об лпупськ лбзеьк пугёшбёу еёктугйён.`;
            const blob = new Blob([content], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "riddle.txt";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function endGame() {
            ui.game.style.display = 'none';
            document.body.style.backgroundColor = 'white';
            document.querySelectorAll('.chain-container').forEach(el => el.style.display = 'none');
            ui.final.style.display = 'flex';
        }

        function toRoman(num) {
            const r = {1:'I',2:'II',3:'III',4:'IV',5:'V',6:'VI'};
            return r[num] || num;
        }

        ui.inp.addEventListener('keypress', e => { if(e.key === 'Enter') check(); });
        initLevel();
    </script>
</body>
</html>